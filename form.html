<!doctype html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gastos Alemania</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-rose-50 via-sky-50 to-emerald-50">
    <main class="mx-auto flex min-h-screen max-w-5xl items-center justify-center p-6">
        <section class="w-full max-w-xl">
            <div class="rounded-3xl bg-white/80 p-8 shadow-xl ring-1 ring-black/5 backdrop-blur">
                <header class="mb-6">
                    <h1 class="text-2xl font-semibold tracking-tight text-slate-800">
                        Registro de Gastos
                    </h1>
                </header>

                <form id="gastoForm" class="space-y-4" autocomplete="off">
                    <!-- Fecha de Compra -->
                    <div class="relative">
                        <input type="date" id="fechaCompra" autocomplete="off" value="<?php echo date('Y-m-d'); ?>" class="peer w-full rounded-2xl border border-slate-300 bg-white/70 px-4 py-3 text-slate-800 placeholder:text-slate-400
             shadow-sm outline-none transition focus:border-sky-300 focus:ring-4 focus:ring-sky-100" />
                        <label for="fechaCompra" class="absolute -top-2 left-3 px-1 text-xs font-medium text-sky-700
             bg-white/90 backdrop-blur rounded-full">
                            Fecha de Compra
                        </label>
                    </div>

                    <!-- Categoría -->
                    <div class="relative">
                        <select id="categoria" autocomplete="off" class="peer w-full appearance-none rounded-2xl border border-slate-300 bg-white/70 px-4 py-3 text-slate-800
             shadow-sm outline-none transition focus:border-emerald-300 focus:ring-4 focus:ring-emerald-100">
                            <option value="" selected disabled></option>
                            <option>Arriendo</option>
                            <option>Caracas</option>
                            <option>Gastos Mariana</option>
                            <option>Gasolina</option>
                            <option>Mercado</option>
                            <option>Otros Gastos</option>
                            <option>Servicios</option>
                            <option>Tarjeta de Crédito</option>
                        </select>

                        <label for="categoria" class="absolute -top-2 left-3 px-2 text-xs font-medium text-emerald-700
             bg-white/90 backdrop-blur rounded-full">
                            Categoría
                        </label>

                        <!-- flechita del select -->
                        <span
                            class="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-slate-500">▾</span>
                    </div>

                    <!-- Descripción -->
                    <div class="relative">
                        <input id="descripcion" autocomplete="off" class="peer w-full rounded-2xl border border-slate-300 bg-white/70 px-4 py-3 text-slate-800 placeholder:text-slate-400
             shadow-sm outline-none transition focus:border-rose-300 focus:ring-4 focus:ring-rose-100" />
                        <label for="descripcion" class="absolute -top-2 left-3 px-2 text-xs font-medium text-rose-700
             bg-white/90 backdrop-blur rounded-full">
                            Descripción
                        </label>
                    </div>

                    <!-- Valor -->
                    <div class="relative">
                        <span
                            class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-slate-500">$</span>
                        <input id="valor" autocomplete="off" inputmode="numeric" class="peer w-full rounded-2xl border border-slate-300 bg-white/70 pl-8 pr-4 py-3 text-slate-800 placeholder:text-slate-400
             shadow-sm outline-none transition focus:border-violet-300 focus:ring-4 focus:ring-violet-100" />
                        <label for="valor" class="absolute -top-2 left-3 px-2 text-xs font-medium text-violet-700
             bg-white/90 backdrop-blur rounded-full">
                            Valor (COP)
                        </label>
                    </div>

                    <div class="pt-2">
                        <button id="btnGuardar" type="submit" class="group inline-flex w-full items-center justify-center gap-2 rounded-2xl
             bg-gradient-to-r from-sky-200 via-rose-200 to-emerald-200 px-4 py-3
             font-semibold text-slate-800 shadow-md shadow-slate-200/60 ring-1 ring-black/5 transition
             hover:brightness-[0.98] active:scale-[0.99] disabled:cursor-not-allowed disabled:opacity-60">
                            <span>Guardar gasto</span>
                            <span class="inline-block transition group-hover:translate-x-0.5">→</span>
                        </button>
                    </div>
                </form>


            </div>
        </section>
    </main>

    <script>
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzidaLrt2pCoCFizQfGz0mRAM8vep8YjDZbXx9alGy4GtKMuV_cjXpoMjd9XUTKJnWp/exec";
        const TOKEN = "CAMBIA_ESTE_TOKEN_LARGO_Y_SEGURO";
        const REDIRECT_TO = "/cash/";

        // JSONP callback (sin mostrar estado)
        window.onGsResponse = function (data) {
            const btn = document.getElementById("btnGuardar");
            btn.disabled = false;

            if (data && data.ok) {
                window.location.href = REDIRECT_TO; // ✅ redirección inmediata
            } else {
                // Si quieres, puedes hacer un alert mínimo (opcional):
                alert("Error: " + (data?.error || "desconocido"));
            }
        };

        function sendJsonp(params) {
            const qs = new URLSearchParams(params).toString();
            const s = document.createElement("script");
            s.src = `${WEB_APP_URL}?${qs}`;
            s.async = true;

            s.onerror = () => {
                s.remove();
                window.onGsResponse({ ok: false, error: "Failed to load script" });
            };

            s.onload = () => {
                // el callback se ejecuta al cargar
                s.remove();
            };

            document.body.appendChild(s);
        }

        document.getElementById("gastoForm").addEventListener("submit", (e) => {
            e.preventDefault();

            const btn = document.getElementById("btnGuardar");
            btn.disabled = true;

            sendJsonp({
                callback: "onGsResponse",
                token: TOKEN,
                fechaCompra: document.getElementById("fechaCompra").value,
                categoria: document.getElementById("categoria").value,
                descripcion: document.getElementById("descripcion").value,
                valor: document.getElementById("valor").value
            });
        });
    </script>

</body>

</html>
